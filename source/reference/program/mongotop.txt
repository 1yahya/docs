.. _mongotop:

============
``mongotop``
============

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. |tool-binary| replace:: mongotop

Synopsis
--------

:binary:`~bin.mongotop` provides a method to track the amount of time a
MongoDB instance spends reading and writing data. :binary:`~bin.mongotop`
provides statistics on a per-collection level. By default,
:binary:`~bin.mongotop` returns values every second.

.. important:: In order to connect to a :binary:`~bin.mongod` that enforces
   authorization with the :option:`--auth <mongod --auth>` option, the
   :option:`--username <mongotop --username>` and
   :option:`--password <mongotop --password>` options must be used, and the
   user specified must have the :authaction:`serverStatus` and
   :authaction:`top` privileges.

   The most appropriate built-in role that has these privileges is
   :authrole:`clusterMonitor`.

.. seealso::

   For more information about monitoring MongoDB, see
   :doc:`/administration/monitoring`.

   For additional background on various other MongoDB status outputs
   see:

   - :doc:`/reference/command/serverStatus`
   - :doc:`/reference/command/replSetGetStatus`
   - :doc:`/reference/command/dbStats`
   - :doc:`/reference/command/collStats`

   For an additional utility that provides MongoDB metrics
   see :doc:`mongostat </reference/program/mongostat>`.

.. _mongotop-options:

Options
-------

.. binary:: mongotop

.. program:: mongotop

.. option:: --help

   Returns information on the options and use of :program:`mongotop`.


.. option:: --verbose, -v

   Increases the amount of internal reporting returned on standard output
   or in log files. Increase the verbosity with the ``-v`` form by
   including the option multiple times, (e.g. ``-vvvvv``.)
   


.. option:: --quiet

   Runs the :program:`mongotop` in a quiet mode that attempts to limit the amount
   of output.

   This option suppresses:
   
   - output from :term:`database commands <database command>`
   
   - replication activity
   
   - connection accepted events
   
   - connection closed events
   


.. option:: --version

   Returns the :program:`mongotop` release number.


.. option:: --host <hostname><:port>, -h <hostname><:port>

   *Default*: localhost:27017

   Specifies a resolvable hostname for the :binary:`~bin.mongod` to which to
   connect. By default, the :program:`mongotop` attempts to connect to a MongoDB
   instance running on the localhost on port number ``27017``.
   
   To connect to a replica set, specify the :setting:`replica set name
   <~replication.replSetName>` and a seed list of set members. Use the
   following form:
   
   .. code-block:: none
   
      <replSetName>/<hostname1><:port>,<hostname2><:port>,<...>
   
   You can always connect directly to a single MongoDB instance by
   specifying the host and port number directly.


.. option:: --port <port>

   *Default*: 27017

   Specifies the TCP port on which the MongoDB instance listens for
   client connections.
   


.. option:: --ipv6

   Enables IPv6 support and allows the :program:`mongotop` to connect to the
   MongoDB instance using an IPv6 network. All MongoDB programs and
   processes disable IPv6 support by default.


.. option:: --ssl

   .. versionadded:: 2.6
   
   Enables connection to a :binary:`~bin.mongod` or :binary:`~bin.mongos` that has
   TLS/SSL support enabled.
   
   The default distribution of MongoDB does not contain support for TLS/SSL.
   For more information on MongoDB and TLS/SSL, see :doc:`/tutorial/configure-ssl`.
   


.. option:: --sslCAFile <filename>

   .. versionadded:: 2.6
   
   Specifies the :file:`.pem` file that contains the root certificate chain
   from the Certificate Authority. Specify the file name of the
   :file:`.pem` file using relative or absolute paths.
   
   The default distribution of MongoDB does not contain support for
   TLS/SSL. For more information on MongoDB and TLS/SSL, see
   :doc:`/tutorial/configure-ssl`.
   
   .. include:: /includes/warning-always-use-sslCAFile-for-mongo.rst
   


.. option:: --sslPEMKeyFile <filename>

   .. versionadded:: 2.6
   
   Specifies the :file:`.pem` file that contains both the TLS/SSL certificate
   and key. Specify the file name of the :file:`.pem` file using relative
   or absolute paths.
   
   This option is required when using the :option:`--ssl` option to connect
   to a :binary:`~bin.mongod` or :binary:`~bin.mongos` that has
   :setting:`~net.ssl.CAFile` enabled *without*
   :setting:`~net.ssl.weakCertificateValidation`.
   
   The default distribution of MongoDB does not contain support for TLS/SSL.
   For more information on MongoDB and TLS/SSL, see :doc:`/tutorial/configure-ssl`.
   


.. option:: --sslPEMKeyPassword <value>

   .. versionadded:: 2.6
   
   Specifies the password to de-crypt the certificate-key file (i.e.
   :option:`--sslPEMKeyFile`). Use the :option:`--sslPEMKeyPassword` option only if the
   certificate-key file is encrypted. In all cases, the :program:`mongotop` will
   redact the password from all logging and reporting output.
   
   If the private key in the PEM file is encrypted and you do not specify
   the :option:`--sslPEMKeyPassword` option, the :program:`mongotop` will prompt for a passphrase. See
   :ref:`ssl-certificate-password`.
   
   The default distribution of MongoDB does not contain support for TLS/SSL.
   For more information on MongoDB and TLS/SSL, see :doc:`/tutorial/configure-ssl`.


.. option:: --sslCRLFile <filename>

   .. versionadded:: 2.6
   
   Specifies the :file:`.pem` file that contains the Certificate Revocation
   List. Specify the file name of the :file:`.pem` file using relative or
   absolute paths.
   
   The default distribution of MongoDB does not contain support for TLS/SSL.
   For more information on MongoDB and TLS/SSL, see :doc:`/tutorial/configure-ssl`.
   


.. option:: --sslAllowInvalidCertificates

   .. versionadded:: 2.6
   
   Bypasses the validation checks for server certificates and allows
   the use of invalid certificates. When using the
   :setting:`~net.ssl.allowInvalidCertificates` setting, MongoDB logs as a
   warning the use of the invalid certificate.
   
   The default distribution of MongoDB does not contain support for TLS/SSL.
   For more information on MongoDB and TLS/SSL, see :doc:`/tutorial/configure-ssl`.
   


.. option:: --sslFIPSMode

   .. versionadded:: 2.6
   
   Directs the :program:`mongotop` to use the FIPS mode of the installed OpenSSL
   library. Your system must have a FIPS compliant OpenSSL library to use
   the :option:`--sslFIPSMode` option.
   
   The default distribution of MongoDB does not contain support for TLS/SSL.
   For more information on MongoDB and TLS/SSL, see :doc:`/tutorial/configure-ssl`.


.. option:: --username <username>, -u <username>

   Specifies a username with which to authenticate to a MongoDB database
   that uses authentication. Use in conjunction with the ``--password`` and
   ``--authenticationDatabase`` options.
   


.. option:: --password <password>, -p <password>

   Specifies a password with which to authenticate to a MongoDB database
   that uses authentication. Use in conjunction with the ``--username`` and
   ``--authenticationDatabase`` options.
   
   If you do not specify an argument for :option:`--password`, :program:`mongotop` will
   prompt interactively for a password on the console.


.. option:: --authenticationDatabase <dbname>

   .. versionadded:: 2.4
   
   Specifies the database that holds the user's credentials.   
   

   :option:`--authenticationDatabase` is required for :binary:`~bin.mongod`
   and :binary:`~bin.mongos` instances that use :ref:`authentication`.


.. option:: --authenticationMechanism <name>

   *Default*: MONGODB-CR

   .. versionadded:: 2.4
   
   .. versionchanged:: 2.6
      Added support for the ``PLAIN`` and ``MONGODB-X509`` authentication
      mechanisms.
   
   Specifies the authentication mechanism the :program:`mongotop` instance uses to
   authenticate to the :binary:`~bin.mongod` or :binary:`~bin.mongos`.
   
   .. list-table::
      :header-rows: 1
      :widths: 20 40
   
      * - Value
   
        - Description
   
      * - MONGODB-CR
   
        - MongoDB challenge/response authentication.
   
      * - MONGODB-X509
   
        - MongoDB TLS/SSL certificate authentication.
   
      * - PLAIN
   
        - External authentication using LDAP. You can also use ``PLAIN``
          for authenticating in-database users. ``PLAIN`` transmits
          passwords in plain text. This mechanism is available only in
          `MongoDB Enterprise
          <http://www.mongodb.com/products/mongodb-enterprise>`_.
   
      * - GSSAPI
   
        - External authentication using Kerberos. This mechanism is
          available only in `MongoDB Enterprise
          <http://www.mongodb.com/products/mongodb-enterprise>`_.


.. option:: --gssapiServiceName

   .. versionadded:: 2.6
   
   Specify the name of the service using :doc:`GSSAPI/Kerberos
   </core/kerberos>`. Only required if the service does not use the
   default name of ``mongodb``.
   
   This option is available only in MongoDB Enterprise.
   


.. option:: --gssapiHostName

   .. versionadded:: 2.6
   
   Specify the hostname of a service using :doc:`GSSAPI/Kerberos
   </core/kerberos>`. *Only* required if the hostname of a machine does
   not match the hostname resolved by DNS.
   
   This option is available only in MongoDB Enterprise.
   


.. option:: --locks

   Toggles the mode of :binary:`~bin.mongotop` to report on use of per-database
   :ref:`locks <locks>`. These data are useful for measuring concurrent
   operations and lock percentage.
   


.. option:: <sleeptime>

   The final argument is the length of time, in seconds, that
   :program:`mongotop` waits in between calls. By default :program:`mongotop` returns
   data every second.


.. _mongotop-fields:

Fields
------

:binary:`~bin.mongotop` returns time values specified in milliseconds
(ms.)

:binary:`~bin.mongotop` only reports active namespaces or databases,
depending on the :option:`--locks` option. If you don't see a database
or collection, it has received no recent activity. You can issue a
simple operation in the :binary:`~bin.mongo` shell to generate activity to
affect the output of :binary:`~bin.mongotop`.

.. data:: mongotop.ns

   Contains the database namespace, which combines the database name
   and collection.

   .. versionchanged:: 2.2
      If you use the :option:`--locks`, the :data:`~mongotop.ns` field does not
      appear in the :binary:`~bin.mongotop` output.

.. data:: mongotop.db

   .. versionadded:: 2.2

   Contains the name of the database. The database named ``.`` refers
   to the global lock, rather than a specific database.

   This field does not appear unless you have invoked
   :binary:`~bin.mongotop` with the :option:`--locks` option.

.. data:: mongotop.total

   Provides the total amount of time that this :binary:`~bin.mongod` spent
   operating on this namespace.

.. data:: mongotop.read

   Provides the amount of time that this :binary:`~bin.mongod` spent
   performing read operations on this namespace.

.. data:: mongotop.write

   Provides the amount of time that this :binary:`~bin.mongod` spent
   performing write operations on this namespace.

.. data:: mongotop.<timestamp>

   Provides a time stamp for the returned data.

Use
---

By default :binary:`~bin.mongotop` connects to the MongoDB instance
running on the localhost port ``27017``. However, :binary:`~bin.mongotop` can optionally
connect to remote :binary:`~bin.mongod`
instances. See the :ref:`mongotop options <mongotop-options>` for more
information.

To force :binary:`~bin.mongotop` to return less frequently specify a number, in
seconds at the end of the command. In this example, :binary:`~bin.mongotop` will
return every 15 seconds.

.. code-block:: sh

   mongotop 15

This command produces the following output:

.. code-block:: sh

   connected to: 127.0.0.1

                       ns       total        read       write           2012-08-13T15:45:40
   test.system.namespaces         0ms         0ms         0ms
     local.system.replset         0ms         0ms         0ms
     local.system.indexes         0ms         0ms         0ms
     admin.system.indexes         0ms         0ms         0ms
                   admin.         0ms         0ms         0ms

                       ns       total        read       write           2012-08-13T15:45:55
   test.system.namespaces         0ms         0ms         0ms
     local.system.replset         0ms         0ms         0ms
     local.system.indexes         0ms         0ms         0ms
     admin.system.indexes         0ms         0ms         0ms
                   admin.         0ms         0ms         0ms


To return a :binary:`~bin.mongotop` report every 5 minutes, use the
following command:

.. code-block:: sh

   mongotop 300

To report the use of per-database locks, use :option:`mongotop --locks`,
which produces the following output:

.. code-block:: sh

   $ mongotop --locks
   connected to: 127.0.0.1

                     db       total        read       write          2012-08-13T16:33:34
                  local         0ms         0ms         0ms
                  admin         0ms         0ms         0ms
                      .         0ms         0ms         0ms
