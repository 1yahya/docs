.. _mongorestore:

================
``mongorestore``
================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. |tool-binary| replace:: mongorestore

.. include:: /includes/admonition-mac-osx-sierra-restriction.rst

Synopsis
--------

The :binary:`~bin.mongorestore` program writes data from a binary database
dump created by :binary:`~bin.mongodump` to a MongoDB instance.

.. versionadded:: 3.0.0 :binary:`~bin.mongorestore` also accepts data to
   restore via the standard input.

:binary:`~bin.mongorestore` can write data to either :binary:`~bin.mongod` or
:binary:`~bin.mongos` instances.

Behavior
--------

Insert Only
~~~~~~~~~~~

:binary:`~bin.mongorestore` can create a new database or add data to an
existing database. However, :binary:`~bin.mongorestore` performs inserts
only and does not perform updates. That is, if restoring documents to
an existing database and collection and existing documents have the
same value ``_id`` field as the to-be-restored documents,
:binary:`~bin.mongorestore` will *not* overwrite those documents.

Rebuild Indexes
~~~~~~~~~~~~~~~

:binary:`~bin.mongorestore` recreates indexes recorded by
:binary:`~bin.mongodump`.

Version Compatibility
~~~~~~~~~~~~~~~~~~~~~

.. include:: /includes/warning-mongodump-compatibility-2.2.rst

.. COMMENT upon completion of TOOLS-1035, either delete the whole section or delete everything after the semicolon.

Exclude ``system.profile`` Collection
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

:binary:`~bin.mongorestore` does not restore the :data:`system.profile
<<database>.system.profile>` collection data; however, if the backup
data includes :data:`system.profile <<database>.system.profile>`
collection data and the collection does not exist in the target
database, :binary:`~bin.mongorestore` creates the collection but does not
insert any data into the collection.

.. _mongorestore-required-access:

Required Access
---------------

.. include:: /includes/access-mongorestore-collections.rst

Options
-------

.. versionchanged:: 3.0.0
   :binary:`~bin.mongorestore` removed the ``--filter``, ``--dbpath``, and the
   ``--noobjcheck`` options.

.. binary:: mongorestore

.. program:: mongorestore

.. option:: --help

   Returns information on the options and use of :program:`mongorestore`.


.. option:: --verbose, -v

   Increases the amount of internal reporting returned on standard output
   or in log files. Increase the verbosity with the ``-v`` form by
   including the option multiple times, (e.g. ``-vvvvv``.)
   


.. option:: --quiet

   Runs the :program:`mongorestore` in a quiet mode that attempts to limit the amount
   of output.

   This option suppresses:
   
   - output from :term:`database commands <database command>`
   
   - replication activity
   
   - connection accepted events
   
   - connection closed events


.. option:: --version

   Returns the :program:`mongorestore` release number.


.. option:: --host <hostname><:port>, -h <hostname><:port>

   *Default*: localhost:27017

   Specifies a resolvable hostname for the :binary:`~bin.mongod` to which to
   connect. By default, the :program:`mongorestore` attempts to connect to a MongoDB
   instance running on the localhost on port number ``27017``.
   
   To connect to a replica set, specify the
   :setting:`~replication.replSetName` and a seed list of set members, as in
   the following:
   
   .. code-block:: none
   
      <replSetName>/<hostname1><:port>,<hostname2><:port>,<...>
   
   You can always connect directly to a single MongoDB instance by
   specifying the host and port number directly.
   
   .. versionchanged:: 3.0.0
      If you use IPv6 and use the ``<address>:<port>`` format, you must
      enclose the portion of an address and port combination in
      brackets (e.g. ``[<address>]``).


.. option:: --port <port>

   *Default*: 27017

   Specifies the TCP port on which the MongoDB instance listens for
   client connections.


.. option:: --ipv6

   Enables IPv6 support and allows the :program:`mongorestore` to connect to the
   MongoDB instance using an IPv6 network. All MongoDB programs and
   processes disable IPv6 support by default.


.. option:: --ssl

   .. versionadded:: 2.6
   
   Enables connection to a :binary:`~bin.mongod` or :binary:`~bin.mongos` that has
   TLS/SSL support enabled.
   
   .. include:: /includes/fact-ssl-supported.rst
   


.. option:: --sslCAFile <filename>

   .. versionadded:: 2.6
   
   Specifies the :file:`.pem` file that contains the root certificate chain
   from the Certificate Authority. Specify the file name of the
   :file:`.pem` file using relative or absolute paths.
   
   .. include:: /includes/fact-ssl-supported.rst
   
   .. warning::
   
      For SSL connections (``--ssl``) to :binary:`~bin.mongod` and
      :binary:`~bin.mongos`, if the :program:`mongorestore` runs without the
      :option:`--sslCAFile`, :program:`mongorestore` will not attempt
      to validate the server certificates. This creates a vulnerability
      to expired :binary:`~bin.mongod` and :binary:`~bin.mongos` certificates as
      well as to foreign processes posing as valid :binary:`~bin.mongod` or
      :binary:`~bin.mongos` instances. Ensure that you *always* specify the
      CA file to validate the server certificates in cases where
      intrusion is a possibility.


.. option:: --sslPEMKeyFile <filename>

   .. versionadded:: 2.6
   
   Specifies the :file:`.pem` file that contains both the TLS/SSL certificate
   and key. Specify the file name of the :file:`.pem` file using relative
   or absolute paths.
   
   This option is required when using the :option:`--ssl` option to connect
   to a :binary:`~bin.mongod` or :binary:`~bin.mongos` that has
   :setting:`~net.ssl.CAFile` enabled *without*
   :setting:`~net.ssl.allowConnectionsWithoutCertificates`.
   
   .. include:: /includes/fact-ssl-supported.rst
   


.. option:: --sslPEMKeyPassword <value>

   .. versionadded:: 2.6
   
   Specifies the password to de-crypt the certificate-key file (i.e.
   :option:`--sslPEMKeyFile`). Use the :option:`--sslPEMKeyPassword` option only if the
   certificate-key file is encrypted. In all cases, the :program:`mongorestore` will
   redact the password from all logging and reporting output.
   
   If the private key in the PEM file is encrypted and you do not specify
   the :option:`--sslPEMKeyPassword` option, the :program:`mongorestore` will prompt for a passphrase. See
   :ref:`ssl-certificate-password`.
   
   .. include:: /includes/fact-ssl-supported.rst


.. option:: --sslCRLFile <filename>

   .. versionadded:: 2.6
   
   Specifies the :file:`.pem` file that contains the Certificate Revocation
   List. Specify the file name of the :file:`.pem` file using relative or
   absolute paths.
   
   .. include:: /includes/fact-ssl-supported.rst
   


.. option:: --sslAllowInvalidCertificates

   .. versionadded:: 2.6
   
   Bypasses the validation checks for server certificates and allows
   the use of invalid certificates. When using the
   :setting:`~net.ssl.allowInvalidCertificates` setting, MongoDB logs as a
   warning the use of the invalid certificate.
   
   .. include:: /includes/fact-ssl-supported.rst
   


.. option:: --sslAllowInvalidHostnames

   .. versionadded:: 3.0
   
   Disables the validation of the hostnames in TLS/SSL certificates. Allows
   :program:`mongorestore` to connect to MongoDB instances even if the hostname in their
   certificates do not match the specified hostname.
   
   .. include:: /includes/fact-ssl-supported.rst


.. option:: --sslFIPSMode

   .. versionadded:: 2.6
   
   Directs the :program:`mongorestore` to use the FIPS mode of the installed OpenSSL
   library. Your system must have a FIPS compliant OpenSSL library to use
   the :option:`--sslFIPSMode` option.
   
   .. include:: /includes/note-fips-is-enterprise-only.rst


.. option:: --username <username>, -u <username>

   Specifies a username with which to authenticate to a MongoDB database
   that uses authentication. Use in conjunction with the ``--password`` and
   ``--authenticationDatabase`` options.
   


.. option:: --password <password>, -p <password>

   Specifies a password with which to authenticate to a MongoDB database
   that uses authentication. Use in conjunction with the ``--username`` and
   ``--authenticationDatabase`` options.
   
   .. versionchanged:: 3.0.0
   
      If you do not specify an argument for :option:`--password`, :program:`mongorestore` returns
      an error.
   
   .. versionchanged:: 3.0.2
   
      If you wish :program:`mongorestore` to prompt the user
      for the password, pass the :option:`--username` option without
      :option:`--password` or specify an empty string as the :option:`--password` value,
      as in ``--password ""`` .
     


.. option:: --authenticationDatabase <dbname>

   .. versionadded:: 2.4
   
   Specifies the database in which the user is created.
   See :ref:`user-authentication-database`.
   


.. option:: --authenticationMechanism <name>

   *Default*: SCRAM-SHA-1

   .. versionadded:: 2.4
   
   .. versionchanged:: 2.6
      Added support for the ``PLAIN`` and ``MONGODB-X509`` authentication
      mechanisms.
   
   .. versionchanged:: 3.0
      Added support for the ``SCRAM-SHA-1`` authentication mechanism. Changed
      default mechanism to ``SCRAM-SHA-1``.
   
   Specifies the authentication mechanism the :program:`mongorestore` instance uses to
   authenticate to the :binary:`~bin.mongod` or :binary:`~bin.mongos`.
   
   .. list-table::
      :header-rows: 1
      :widths: 20 40
   
      * - Value
   
        - Description
   
      * - :ref:`SCRAM-SHA-1 <authentication-scram-sha-1>`
   
        - `RFC 5802 <https://tools.ietf.org/html/rfc5802>`_ standard
          Salted Challenge Response Authentication Mechanism using the SHA1
          hash function.
   
      * - :ref:`MONGODB-CR <authentication-mongodb-cr>`
   
        - MongoDB challenge/response authentication.
   
      * - :ref:`MONGODB-X509 <security-auth-x509>`
   
        - MongoDB TLS/SSL certificate authentication.
   
      * - :ref:`GSSAPI <security-auth-kerberos>` (Kerberos)
   
        - External authentication using Kerberos. This mechanism is
          available only in `MongoDB Enterprise
          <http://www.mongodb.com/products/mongodb-enterprise?jmp=docs>`_.
   
      * - :ref:`PLAIN <security-auth-ldap>` (LDAP SASL)
   
        - External authentication using LDAP. You can also use ``PLAIN``
          for authenticating in-database users. ``PLAIN`` transmits
          passwords in plain text. This mechanism is available only in
          `MongoDB Enterprise
          <http://www.mongodb.com/products/mongodb-enterprise?jmp=docs>`_.


.. option:: --gssapiServiceName

   .. versionadded:: 2.6
   
   Specify the name of the service using :doc:`GSSAPI/Kerberos
   </core/kerberos>`. Only required if the service does not use the
   default name of ``mongodb``.
   
   This option is available only in MongoDB Enterprise.
   


.. option:: --gssapiHostName

   .. versionadded:: 2.6
   
   Specify the hostname of a service using :doc:`GSSAPI/Kerberos
   </core/kerberos>`. *Only* required if the hostname of a machine does
   not match the hostname resolved by DNS.
   
   This option is available only in MongoDB Enterprise.
   


.. option:: --db <database>, -d <database>

   Specifies a database for :program:`mongorestore` to restore data *into*.
   If the database does not exist, :program:`mongorestore` creates the
   database. If you do not specify a ``<db>``, :program:`mongorestore`
   creates new databases that correspond to the databases where data
   originated and data may be overwritten. Use this option to restore data
   into a MongoDB instance that already has data.
   
   :option:`--db` does *not* control which :term:`BSON` files
   :program:`mongorestore` restores. You must use the
   :program:`mongorestore` :ref:`path option <mongorestore-path-option>` to
   limit that restored data.


.. option:: --collection <collection>, -c <collection>

   Specifies a single collection for :program:`mongorestore` to restore. If
   you do not specify :option:`--collection`, :program:`mongorestore` takes
   the collection name from the input filename. If the input file has an
   extension, MongoDB omits the extension of the file from the collection
   name.


.. option:: --objcheck

   Forces :program:`mongorestore` to validate all requests from clients
   upon receipt to ensure that clients never insert invalid documents into
   the database. For objects with a high degree of sub-document nesting,
   :option:`--objcheck` can have a small impact on performance.
   
   .. versionchanged:: 2.4
      MongoDB enables :option:`--objcheck` by default, to prevent any
      client from inserting malformed or invalid BSON into a MongoDB
      database.


.. option:: --drop

   Before restoring the collections from the dumped backup, drops the
   collections from the target database. :option:`--drop` does not drop
   collections that are not in the backup.
   
   When the restore includes the ``admin`` database, :program:`mongorestore` with
   :option:`--drop` removes all user credentials and replaces them with the
   users defined in the dump file. Therefore, in systems with
   :setting:`~security.authorization` enabled, :program:`mongorestore` must be able
   to authenticate to an existing user *and* to a user defined in the
   dump file. If :program:`mongorestore` can't authenticate to a user defined in the
   dump file, the restoration process will fail, leaving an empty
   database.


.. option:: --oplogReplay

   After restoring the database dump, replays the :term:`oplog` entries
   from the :file:`oplog.bson` file located in the top level of the dump
   directory. When used in conjunction with :option:`mongodump --oplog`,
   :binary:`~bin.mongorestore --oplogReplay <mongorestore>`
   restores the database to the point-in-time backup captured with the
   ``mongodump --oplog`` command. For an example of :option:`--oplogReplay`, see
   :ref:`backup-restore-oplogreplay`.
   
   :binary:`~bin.mongorestore --oplogReplay <mongorestore>` replays any
   valid :file:`oplog.bson` file found in the top level of the dump
   directory. That is, if you have a bson file that contains valid oplog
   entries, you can name the file ``oplog.bson`` and move it to the top
   level of the dump directory for :binary:`~bin.mongorestore --oplogReplay
   <mongorestore>` to replay.
   
   .. seealso:: :ref:`mongorestore Required Access <mongorestore-required-access>`


.. option:: --oplogLimit <timestamp>

   Prevents :program:`mongorestore` from applying :term:`oplog` entries
   with timestamp newer than or equal to ``<timestamp>``. Specify
   ``<timestamp>`` values in the form of ``<time_t>:<ordinal>``, where
   ``<time_t>`` is the seconds since the UNIX epoch, and ``<ordinal>``
   represents a counter of operations in the oplog that occurred in the
   specified second.
   
   You must use :option:`--oplogLimit` in conjunction with the
   :option:`--oplogReplay` option.


.. option:: --keepIndexVersion

   Prevents :program:`mongorestore` from upgrading the index to the latest
   version during the restoration process.


.. option:: --noIndexRestore

   Prevents :program:`mongorestore` from restoring and building indexes as
   specified in the corresponding :binary:`~bin.mongodump` output.


.. option:: --noOptionsRestore

   Prevents :program:`mongorestore` from setting the collection options,
   such as those specified by the :dbcommand:`collMod` :term:`database
   command`, on restored collections.


.. option:: --restoreDbUsersAndRoles

   Restore user and role definitions for the given database. See
   :doc:`/reference/system-roles-collection` and
   :doc:`/reference/system-users-collection` for more information.
   


.. option:: --writeConcern <document>

   *Default*: majority

   Specifies the :term:`write concern` for each write operation that :program:`mongorestore`
   writes to the target database.
   
   Specify the write concern as a document with :ref:`w options <wc-w>`.


.. option:: --maintainInsertionOrder

   *Default*: false

   If specified, :program:`mongorestore` inserts the documents in the order of
   their appearance in the input source, otherwise :program:`mongorestore` may
   perform the insertions in an arbitrary order.


.. option:: --numParallelCollections int, -j int

   *Default*: 4

   Number of collections :program:`mongorestore` should restore
   in parallel.
   
   If you specify ``-j`` when restoring a *single* collection, ``-j``
   maps to the :option:`--numInsertionWorkersPerCollection` option rather than
   :option:`--numParallelCollections`.


.. option:: --numInsertionWorkersPerCollection int

   *Default*: 1

   .. versionadded:: 3.0.0
   
   Specifies the number of insertion workers to run concurrently per collection.
   

   For large imports, increasing the number of insertion workers
   may increase the speed of the import.
   


.. option:: --stopOnError

   .. versionadded:: 3.0.0
   
   Forces :program:`mongorestore` to halt the restore when it encounters an
   error.


.. _mongorestore-path-option:

.. option:: <path>

   The final argument of the :program:`mongorestore` command is a
   directory path. This argument specifies the location of the
   database dump from which to restore.
   
   You cannot specify both the ``<path>`` argument and the ``--dir``
   option, which also specifies the dump directory, to :program:`mongorestore`.


.. option:: --dir string

   Specifies the dump directory.
   
   You cannot specify both the ``--dir`` option and the ``<path>``
   argument, which also specifies the dump directory, to :program:`mongorestore`.


Use
---

For an overview of :binary:`~bin.mongorestore` usage, see
:doc:`/tutorial/backup-and-restore-tools`.

For an overview of :binary:`~bin.mongodump`, which provides the related
inverse functionality, see the :doc:`mongodump` document.

Consider the following example:

.. code-block:: sh

   mongorestore --collection people --db accounts dump/accounts/people.bson

Here, :binary:`~bin.mongorestore` reads the database dump in the ``dump/``
sub-directory of the current directory, and restores *only* the
documents in the collection named ``people`` from the database named
``accounts``. :binary:`~bin.mongorestore` restores data to the instance
running on the localhost interface on port ``27017``.

In the following example, :binary:`~bin.mongorestore` restores a database
dump located at ``/opt/backup/mongodump-2011-10-24``, to a database
running on port ``37017`` on the host
``mongodb1.example.net``. The :binary:`~bin.mongorestore` command authenticates to
the MongoDB instance using the username ``user`` and the
password ``pass``, as follows:

.. code-block:: sh

   mongorestore --host mongodb1.example.net --port 37017 --username user --password pass /opt/backup/mongodump-2011-10-24

You can also *pipe* data directly into to :binary:`~bin.mongorestore`
through standard input, as in the following example:

.. code-block:: sh

   zcat /opt/backup/mongodump-2014-12-03/accounts.people.bson.gz | mongorestore --collection people --db accounts -
